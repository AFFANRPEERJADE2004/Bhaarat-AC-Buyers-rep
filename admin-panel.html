<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Admin - Bhaarat AC Buyers</title>
    <!-- Add PWA support for "Add to Home Screen" -->
    <link rel="manifest" href="manifest.json">
    <style>
        /* Mobile-first design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #f5f7fa;
            padding: 0;
            margin: 0;
        }
        
        /* App header */
        .app-header {
            background: linear-gradient(135deg, #0066CC, #004A99);
            color: white;
            padding: 20px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,102,204,0.2);
        }
        
        .app-header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        /* Stats cards for mobile */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 16px;
            margin-top: -20px;
        }
        
        .stat-card {
            background: white;
            padding: 16px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #0066CC;
            line-height: 1.2;
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }
        
        /* Filter tabs */
        .filter-tabs {
            display: flex;
            gap: 8px;
            padding: 16px;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .filter-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .filter-btn {
            background: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn.active {
            background: #0066CC;
            color: white;
        }
        
        /* Action buttons */
        .action-bar {
            display: flex;
            gap: 8px;
            padding: 0 16px 16px;
        }
        
        .action-btn {
            flex: 1;
            background: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            color: #0066CC;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .action-btn.primary {
            background: #0066CC;
            color: white;
        }
        
        /* Listings */
        .listings-section {
            padding: 16px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            padding-left: 4px;
        }
        
        .listing-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid transparent;
            transition: transform 0.2s;
            cursor: pointer;
        }
        
        .listing-card.unread {
            border-left-color: #FF6B35;
            background: #fff9f5;
        }
        
        .listing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .customer-name {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
        }
        
        .new-badge {
            background: #FF6B35;
            color: white;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .listing-details {
            margin-bottom: 10px;
        }
        
        .detail-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 14px;
            color: #666;
        }
        
        .detail-icon {
            width: 20px;
            color: #0066CC;
        }
        
        .ac-details {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            margin-top: 8px;
            font-size: 13px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 8px;
        }
        
        /* .status-pending {
            background: #fff3cd;
            color: #856404;
        } */
        
        .status-contacted {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        /* Modal for details */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 16px;
            align-items: flex-end;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px 24px 0 0;
            padding: 24px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            font-size: 20px;
            color: #0066CC;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .info-grid {
            display: grid;
            gap: 16px;
        }
        
        .info-row {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .info-label {
            width: 90px;
            font-weight: 600;
            color: #666;
        }
        
        .info-value {
            flex: 1;
            color: #1a1a1a;
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .whatsapp-btn {
            background: #25D366;
            color: white;
        }
        
        .call-btn {
            background: #0066CC;
            color: white;
        }
        
        /* Loading state */
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            background: white;
            border-radius: 16px;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <div class="app-header">
        <h1>üìã Bhaarat AC Buyers</h1>
        <div style="font-size: 14px; opacity: 0.9;">Admin Dashboard</div>
    </div>
    
    <!-- Stats Cards -->
    <div class="stats-grid" id="stats">
        <div class="stat-card">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">Total</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="todayCount">0</div>
            <div class="stat-label">Today</div>
        </div>
        <!-- <div class="stat-card">
            <div class="stat-number" id="pendingCount">0</div>
            <div class="stat-label">Pending</div>
        </div> -->
        <div class="stat-card">
            <div class="stat-number" id="unreadCount">0</div>
            <div class="stat-label">New</div>
        </div>
    </div>
    
    <!-- Filter Tabs (scrollable) -->
    <div class="filter-tabs">
        <button class="filter-btn active" onclick="filterListings('all', this)">All</button>
        <button class="filter-btn" onclick="filterListings('today', this)">Today</button>
        <!-- <button class="filter-btn" onclick="filterListings('pending', this)">Pending</button> -->
        <button class="filter-btn" onclick="filterListings('unread', this)">Unread</button>
    </div>
    
    <!-- Action Buttons -->
    <div class="action-bar">
        <button class="action-btn" onclick="refreshData()">
            <span>üîÑ</span> Refresh
        </button>
        <button class="action-btn" onclick="markAllAsRead()">
            <span>‚úì</span> Mark All Read
        </button>
        <!-- <button class="action-btn primary" onclick="exportData()">
            <span>üì•</span> Export -->
        </button>
    </div>
    
    <!-- Listings -->
    <div class="listings-section">
        <div class="section-title">Recent Listings</div>
        <div id="listingsContainer" class="loading">
            Loading...
        </div>
    </div>
    
    <!-- Detail Modal -->
    <div class="modal" id="detailModal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Customer Details</h3>
                <button class="close-btn" onclick="closeModal()">‚úï</button>
            </div>
            <div class="info-grid" id="modalContent">
                <!-- Filled by JavaScript -->
            </div>
            <div class="modal-actions" id="modalActions">
                <!-- Filled by JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        let currentFilter = 'all';
        let allListings = [];
        let currentListing = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            checkNotifications();
            setInterval(checkNotifications, 5000);
        });
        
        function loadData() {
            const submissions = JSON.parse(localStorage.getItem('acSubmissions') || '[]');
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            
            allListings = submissions.reverse();
            updateStats(submissions, notifications);
            displayListings(submissions);
        }
        
        function updateStats(submissions, notifications) {
            const today = new Date().toDateString();
            const todayCount = submissions.filter(s => 
                new Date(s.submittedAt).toDateString() === today
            ).length;
            
            const unreadCount = notifications.filter(n => !n.read).length;
            
            document.getElementById('totalCount').textContent = submissions.length;
            document.getElementById('todayCount').textContent = todayCount;
            // document.getElementById('pendingCount').textContent = 
            //     submissions.filter(s => s.status === 'pending').length;
            document.getElementById('unreadCount').textContent = unreadCount;
            
            // Update page title with unread count
            document.title = unreadCount > 0 
                ? `(${unreadCount}) Bhaarat AC Admin` 
                : 'Bhaarat AC Admin';
        }
        
        function displayListings(submissions) {
            const container = document.getElementById('listingsContainer');
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            
            let filtered = filterData(submissions, currentFilter, notifications);
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <div>No ${currentFilter} listings</div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filtered.forEach(listing => {
                const isUnread = notifications.some(n => n.id === listing.id && !n.read);
                const date = new Date(listing.submittedAt).toLocaleString('en-IN', {
                    day: 'numeric',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                html += `
                    <div class="listing-card ${isUnread ? 'unread' : ''}" onclick="viewListing(${listing.id})">
                        <div class="listing-header">
                            <span class="customer-name">${listing.fullName}</span>
                            ${isUnread ? '<span class="new-badge">NEW</span>' : ''}
                        </div>
                        <div class="listing-details">
                            <div class="detail-row">
                                <span class="detail-icon">üìç</span>
                                <span>${listing.area}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-icon">üìû</span>
                                <span>${listing.mobile}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-icon">‚è±Ô∏è</span>
                                <span>${date}</span>
                            </div>
                        </div>
                        <div class="ac-details">
                            <strong>${listing.brand} ${listing.acType}</strong> ‚Ä¢ ${listing.capacity} Ton ‚Ä¢ ${listing.age}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function filterData(submissions, filter, notifications) {
            if (filter === 'all') return submissions;
            
            if (filter === 'today') {
                const today = new Date().toDateString();
                return submissions.filter(s => 
                    new Date(s.submittedAt).toDateString() === today
                );
            }
            
            // if (filter === 'pending') {
            //     return submissions.filter(s => s.status === 'pending');
            // }
            
            if (filter === 'unread') {
                const unreadIds = notifications.filter(n => !n.read).map(n => n.id);
                return submissions.filter(s => unreadIds.includes(s.id));
            }
            
            return submissions;
        }
        
        function viewListing(id) {
            const submissions = JSON.parse(localStorage.getItem('acSubmissions') || '[]');
            currentListing = submissions.find(s => s.id === id);
            
            if (!currentListing) return;
            
            // Mark as read
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            const updated = notifications.map(n => {
                if (n.id === id) n.read = true;
                return n;
            });
            localStorage.setItem('adminNotifications', JSON.stringify(updated));
            
            // Show modal
            showModal(currentListing);
        }
        
        function showModal(listing) {
            const modal = document.getElementById('detailModal');
            const modalContent = document.getElementById('modalContent');
            const modalActions = document.getElementById('modalActions');
            
            modalContent.innerHTML = `
                <div class="info-row">
                    <div class="info-label">Name</div>
                    <div class="info-value">${listing.fullName}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Mobile</div>
                    <div class="info-value">${listing.mobile}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Address</div>
                    <div class="info-value">${listing.address}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Area</div>
                    <div class="info-value">${listing.area}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">AC Details</div>
                    <div class="info-value">
                        ${listing.brand} ${listing.acType}<br>
                        ${listing.capacity} Ton, ${listing.age}<br>
                        Condition: ${listing.condition}
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-label">Notes</div>
                    <div class="info-value">${listing.notes || 'No notes'}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Submitted</div>
                    <div class="info-value">${new Date(listing.submittedAt).toLocaleString()}</div>
                </div>
            `;
            
            modalActions.innerHTML = `
                <button class="modal-btn whatsapp-btn" onclick="openWhatsApp('${listing.mobile}', '${listing.fullName}')">
                    üí¨ WhatsApp
                </button>
                <button class="modal-btn call-btn" onclick="window.location.href='tel:${listing.mobile}'">
                    üìû Call
                </button>
            `;
            
            modal.classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
            refreshData();
        }
        
        function openWhatsApp(mobile, name) {
            const message = `Hi ${name}, I received your AC listing. Let's discuss.`;
            window.open(`https://wa.me/91${mobile}?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function filterListings(filter, btn) {
            currentFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            
            loadData();
        }
        
        function refreshData() {
            loadData();
        }
        
        function markAllAsRead() {
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            notifications.forEach(n => n.read = true);
            localStorage.setItem('adminNotifications', JSON.stringify(notifications));
            refreshData();
        }
        
        // function exportData() {
        //     const submissions = JSON.parse(localStorage.getItem('acSubmissions') || '[]');
        //     const dataStr = JSON.stringify(submissions, null, 2);
        //     const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
        //     const link = document.createElement('a');
        //     link.href = dataUri;
        //     link.download = `ac-submissions-${new Date().toISOString().split('T')[0]}.json`;
        //     link.click();
        // }
        
        function checkNotifications() {
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            const unreadCount = notifications.filter(n => !n.read).length;
            
            if (unreadCount > 0) {
                document.title = `(${unreadCount}) Bhaarat AC Admin`;
            }
            
            // Refresh if data changed
            const currentData = JSON.stringify(allListings);
            const newData = JSON.stringify(JSON.parse(localStorage.getItem('acSubmissions') || '[]'));
            
            if (currentData !== newData) {
                loadData();
            }
        }
        
        // Add to home screen prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            // You can show a custom "Add to Home Screen" button here
        });
        
// ============================================
// SILENT AUTO-CLEANUP - Runs without admin knowing
// ============================================

// Configuration
const CLEANUP_CONFIG = {
    DAYS_TO_KEEP: 7,              // Keep last 7 days, delete older
    CHECK_INTERVAL: 60 * 60 * 1000, // Check every hour (in milliseconds)
    RUN_ON_LOAD: true,              // Run when admin opens panel
    SILENT_MODE: true               // No alerts, no toasts, no console logs
};

// Silent logger (only logs if SILENT_MODE is false)
function silentLog(...args) {
    if (!CLEANUP_CONFIG.SILENT_MODE) {
        console.log(...args);
    }
}

// Silent toast (does nothing in silent mode)
function silentToast(message) {
    // Intentionally empty - no notifications
}

// Main cleanup function - runs silently
async function performSilentCleanup() {
    try {
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - CLEANUP_CONFIG.DAYS_TO_KEEP);
        
        let totalDeleted = 0;
        
        // ===== 1. CLEAN SUPABASE (CLOUD) =====
        if (typeof supabase !== 'undefined' && supabase) {
            try {
                const { data, error } = await supabase
                    .from('ac_listings')
                    .delete()
                    .lt('submitted_at', cutoffDate.toISOString());
                
                if (!error) {
                    totalDeleted += data?.length || 0;
                }
            } catch (e) {
                // Silently fail - no errors shown
            }
        }
        
        // ===== 2. CLEAN LOCALSTORAGE (ADMIN PANEL) =====
        try {
            // Clean acSubmissions
            const submissions = JSON.parse(localStorage.getItem('acSubmissions') || '[]');
            const filteredSubmissions = submissions.filter(item => {
                const itemDate = new Date(item.submittedAt || item.submitted_at);
                return itemDate > cutoffDate;
            });
            localStorage.setItem('acSubmissions', JSON.stringify(filteredSubmissions));
            
            // Clean adminNotifications
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            const filteredNotifications = notifications.filter(item => {
                const itemDate = new Date(item.time);
                return itemDate > cutoffDate;
            });
            localStorage.setItem('adminNotifications', JSON.stringify(filteredNotifications));
            
            totalDeleted += (submissions.length - filteredSubmissions.length);
            totalDeleted += (notifications.length - filteredNotifications.length);
            
        } catch (e) {
            // Silently fail
        }
        
        // ===== 3. STORE LAST CLEANUP TIME (silently) =====
        try {
            const today = new Date().toDateString();
            localStorage.setItem('lastSilentCleanup', today);
            localStorage.setItem('lastCleanupStats', JSON.stringify({
                date: new Date().toISOString(),
                deleted: totalDeleted
            }));
        } catch (e) {
            // Silently fail
        }
        
        silentLog(`‚úÖ Silent cleanup completed: ${totalDeleted} old items removed`);
        
    } catch (error) {
        // Absolutely no errors shown to admin
        silentLog('Silent cleanup error (suppressed):', error);
    }
}

// ===== AUTO-CLEANUP TRIGGERS =====

// 1. Run when page loads (if enabled)
if (CLEANUP_CONFIG.RUN_ON_LOAD) {
    // Check if we already ran today
    const lastCleanup = localStorage.getItem('lastSilentCleanup');
    const today = new Date().toDateString();
    
    if (lastCleanup !== today) {
        // Run immediately but don't wait for it
        setTimeout(performSilentCleanup, 2000); // Run 2 seconds after page load
    }
}

// 2. Run periodically in the background
setInterval(() => {
    // Check if we should run (once per day)
    const lastCleanup = localStorage.getItem('lastSilentCleanup');
    const today = new Date().toDateString();
    
    if (lastCleanup !== today) {
        performSilentCleanup(); // Run in background
    }
}, CLEANUP_CONFIG.CHECK_INTERVAL);

// 3. Run when browser is idle
if ('requestIdleCallback' in window) {
    requestIdleCallback(() => {
        const lastCleanup = localStorage.getItem('lastSilentCleanup');
        const today = new Date().toDateString();
        
        if (lastCleanup !== today) {
            performSilentCleanup();
        }
    }, { timeout: 30000 });
}

// 4. Run before page unload (optional)
window.addEventListener('beforeunload', function() {
    // Don't run cleanup here - just log
    silentLog('Page closing, cleanup not run');
});

// ===== OVERRIDE EXISTING FUNCTIONS TO REMOVE NOTIFICATIONS =====

// Store original functions
const originalShowToast = window.showToast;
const originalAlert = window.alert;
const originalConfirm = window.confirm;

// Override toast to do nothing
window.showToast = function() {
    // Silent - no toast notifications
    return;
};

// Optional: Override alert for specific cases
window.alert = function(message) {
    // Only show critical errors, not cleanup messages
    if (message && message.includes('cleanup')) {
        return; // Block cleanup messages
    }
    return originalAlert.apply(this, arguments);
};

// Override any existing cleanup functions to be silent
window.runManualCleanup = function() {
    // Disable manual cleanup button - or make it do nothing
    silentLog('Manual cleanup disabled in silent mode');
    return;
};

// ===== ADD SILENT CLEANUP TO EXISTING LOAD FUNCTION =====

// Wrap the existing loadData function to include silent cleanup
if (typeof loadData === 'function') {
    const originalLoadData = loadData;
    window.loadData = async function() {
        // Run silent cleanup first (but don't wait for it)
        performSilentCleanup().then(() => {
            // Continue with normal load
            return originalLoadData.apply(this, arguments);
        }).catch(() => {
            // If cleanup fails, still load data
            return originalLoadData.apply(this, arguments);
        });
    };
}

// ===== PERIODIC CLEANUP CHECK (EVEN IF PAGE IS OPEN) =====

// Check every hour if we need to cleanup
setInterval(() => {
    const lastCleanup = localStorage.getItem('lastSilentCleanup');
    const today = new Date().toDateString();
    
    if (lastCleanup !== today) {
        performSilentCleanup();
    }
}, 60 * 60 * 1000); // Every hour

// ===== STORAGE CLEANUP (for localStorage itself) =====

// Prevent localStorage from growing too large
function silentStorageCleanup() {
    try {
        // Check if localStorage is getting full (> 4MB)
        let totalSize = 0;
        for (let key in localStorage) {
            if (localStorage.hasOwnProperty(key)) {
                totalSize += (localStorage[key].length * 2); // Approximate size in bytes
            }
        }
        
        // If localStorage > 4MB, clean old data
        if (totalSize > 4 * 1024 * 1024) {
            silentLog('LocalStorage getting full, performing deep cleanup');
            
            // Keep only last 30 days of data
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            // Clean submissions
            const submissions = JSON.parse(localStorage.getItem('acSubmissions') || '[]');
            const filtered = submissions.filter(s => {
                const date = new Date(s.submittedAt || s.submitted_at);
                return date > thirtyDaysAgo;
            });
            localStorage.setItem('acSubmissions', JSON.stringify(filtered));
            
            // Clean notifications
            const notifications = JSON.parse(localStorage.getItem('adminNotifications') || '[]');
            const filteredNotifs = notifications.filter(n => {
                const date = new Date(n.time);
                return date > thirtyDaysAgo;
            });
            localStorage.setItem('adminNotifications', JSON.stringify(filteredNotifs));
        }
    } catch (e) {
        // Silently fail
    }
}

// Run storage cleanup occasionally
setInterval(silentStorageCleanup, 6 * 60 * 60 * 1000); // Every 6 hours

// ===== DEBUGGING (only shows if you enable it) =====

// To check cleanup status, admin would need to type this in console:
window.checkCleanupStatus = function() {
    const lastCleanup = localStorage.getItem('lastSilentCleanup');
    const stats = JSON.parse(localStorage.getItem('lastCleanupStats') || '{}');
    
    console.log('üîç Cleanup Status:');
    console.log('Last cleanup:', lastCleanup || 'Never');
    console.log('Items deleted:', stats.deleted || 0);
    console.log('Last run:', stats.date ? new Date(stats.date).toLocaleString() : 'Never');
    console.log('Days kept:', CLEANUP_CONFIG.DAYS_TO_KEEP);
    
    // Count current items
    const submissions = JSON.parse(localStorage.getItem('acSubmissions') || '[]');
    console.log('Current items in storage:', submissions.length);
};

console.log('ü§´ Silent auto-cleanup system active (admin will not see any notifications)');
    </script>
</body>
</html>